# Hyperledger Fabric Supply Chain Network
### Four (4) Organizations, each with (atleast) two (2) peers.

# Prerequisites:
- **Node.js version 8.9.0+ (but not higher than 9.0)**
- **Docker and Docker Compose (latest)**
- **Golang (latest) with $GOPATH set**
- **Chaincode installed to $GOPATH/src/github.com/chainergy/chaincode**

# Fabric-Network
## Bringing up the network.
Make sure you are in the Fabric-Network directory.
``` bash
cd Fabric-Network
```
### Calling the byfn.sh script with various options:
``` bash
./byfn.sh up -s <couchdb> -o <etcdraft | kafka | solo>
```
**Example bringing up a network using couchdb and etcdraft ordering service**
``` bash
./byfn.sh up -s couchdb -o etcdraft
```

### Once the network is up you will need to start the Certificate Authorities (CA)
``` bash
docker-compose -f docker-compose-ca.yaml up
```
**Add -d at the end of the above command to run in detached mode**

# Node-Express-SDK
## Starting the node app + SDK
Make sure you are in the Fabric-Node-SDK directory
``` bash
cd ../Fabric-Node-SDK
```
### Install the node modules
**Note: I am using node version 8.12.0 with npm version 6.4.1** 

**You cannot use a node version above 9.0!!!**
``` bash
npm install
```

**If you've restarted the fabric network you will need to delete the old certificates and create new users**
``` bash
./fresh.sh
```

### Starting the node app server
``` bash
npm run dev
```
**The server will started on port 3000 (localhost:3000)**

**This uses a module called 'nodemon' to restart the server whenever a change is made**

### Using the API (CAN USE FRONT END NOW)
#### Send POST requests to the various endpoints:
- **/ORGNAME/users/create**
``` JSON
{
	"id": "Steve",
	"secret": "12345",
	"org": "ORGNAME",
	"roles": ["dev"],
	"affiliation": "org1.department1"
}
```
This can take two tries the first time it is ran per organization. This is due to the 'admin' user not existing yet. 

- **/ORGNAME/users/search**
```JSON
{
	"org": "ORGNAME", 
	"id": "Steve"
}
```

- **/ORGNAME/chaincode/install**
```JSON
{
	"org": "ORGNAME",
	"peers": ["peer0.ORGNAME.energyXchain.com", "peer1.ORGNAME.energyXchain.com"],
	"CCPath": "github.com/EnergyXChain/chaincode/sample/",
	"CCName": "sampleCC",
	"CCVersion":"1.0",
	"CCType":"golang"
}
```
If you choose to write your own chaincode you will need to change the chaincode directories in the docker-compose files as well as the **'CCPATH'** argument. Make sure the chaincode is installed at **$GOPATH/src/github.com/THE_GITHUB_ACCOUNT/path/to/chaincode**

- **/ORGNAME/chaincode/instantiate**
```JSON
{
	"org": "ORGNAME",
	"peers": ["peer0.ORGNAME.energyXchain.com", "peer1.ORGNAME.energyXchain.com"],
	"channelName": "mychannel",
	"CCName": "sampleCC",
	"CCVersion":"1.0",
	"CCType":"golang",
	"fcn": "init",
	"args": ["a","50", "b", "100"]
}
```
Make sure that all peers on the channel have the chaincode installed, unless you change the policy settings.

- **/ORGNAME/chaincode/invoke**
```JSON
{
	"org": "ORGNAME", 
	"id": "Steve", 
	"fcn": "invoke", 
	"args": ["a", "b", "5"],
	"CCName": "sampleCC",
	"channelName": "mychannel"
}
```

- **/ORGNAME/chaincoke/query**
```
{
	"org": "ORGNAME", 
	"id": "Steve", 
	"fcn": "query", 
	"args": ["a"],
	"CCName": "sampleCC",
	"channelName": "mychannel"
}
```

- **/ORGNAME/channel/create**
```JSON
{
	"org": "ORGNAME", 
	"ordererName": "orderer.energyXchain.com",
	"channelConfigPath": "../../Fabric-Network/channel-artifacts/channel1.tx",
	"channelName": "mychannel1"
}
```
As of now the scripts only generate two (2) channels, if you wish to create and join more you will need to modify the **'byfn.sh'** to generate the binaries for more channels. You can only 'create' channels that have been generated by the channel artifacts (channel.tx, channel1.tx, etc.)

**/ORGNAME/channel/join**
```JSON
{
	"org": "ORGNAME", 
	"ordererName": "orderer.energyXchain.com",
	"channelName": "mychannel1",
	"peers": ["peer0.ORGNAME.energyXchain.com"]
}
```

# Front-end
**Start the react app**
``` bash
npm start
```

**It will ask you to start on a different port (SDK is running on 3000) just accept**

**Login with either "producer, consumer, transporter, shipper"**
